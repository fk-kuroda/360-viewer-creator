<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360Â° ãƒ“ãƒ¥ãƒ¯ãƒ¼ä½œæˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #ddd6fe 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 40px;
        }
        h1 {
            color: #1e293b;
            font-size: 32px;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #64748b;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 40px;
        }
        .section-title {
            color: #334155;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        .upload-area {
            border: 2px dashed #818cf8;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .upload-area:hover {
            border-color: #6366f1;
            background: #eef2ff;
        }
        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px;
            color: #6366f1;
        }
        .upload-text {
            color: #1e293b;
            font-weight: 500;
            margin-bottom: 4px;
        }
        .upload-hint {
            color: #64748b;
            font-size: 14px;
        }
        .image-preview {
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
            max-width: 100%;
        }
        .image-preview img {
            width: 100%;
            height: auto;
            display: block;
        }
        .size-info {
            color: #16a34a;
            font-size: 14px;
            margin-top: 8px;
            font-weight: 600;
        }
        .size-info.warning {
            color: #dc2626;
        }
        .recommendation {
            background: #ecfdf5;
            border: 1px solid #6ee7b7;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-size: 14px;
            color: #065f46;
            text-align: left;
        }
        .recommendation strong {
            display: block;
            margin-bottom: 4px;
        }
        .warning {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            display: flex;
            gap: 8px;
            font-size: 14px;
            color: #92400e;
        }
        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: #6366f1;
            color: white;
        }
        .btn-primary:hover {
            background: #4f46e5;
        }
        .btn-secondary {
            background: #64748b;
            color: white;
        }
        .btn-secondary:hover {
            background: #475569;
        }
        .btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }
        .field-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .field-item {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            background: #f8fafc;
            padding: 16px;
            border-radius: 8px;
            cursor: move;
            transition: box-shadow 0.2s;
        }
        .field-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .drag-handle {
            color: #94a3b8;
            cursor: grab;
            padding-top: 8px;
        }
        .field-inputs {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .input {
            padding: 10px 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }
        .input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        .btn-delete {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 8px;
            margin-top: 4px;
        }
        .btn-delete:hover {
            color: #dc2626;
        }
        .action-buttons {
            display: flex;
            gap: 16px;
        }
        .action-buttons button {
            flex: 1;
            padding: 14px;
            font-size: 16px;
        }
        .info-box {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            font-size: 14px;
            color: #1e40af;
        }
        .warning-box {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            font-size: 14px;
            color: #92400e;
        }
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            .field-inputs {
                grid-template-columns: 1fr;
            }
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>360Â° ãƒ“ãƒ¥ãƒ¯ãƒ¼ä½œæˆãƒ„ãƒ¼ãƒ«</h1>
        <p class="subtitle">ä¸å‹•ç”£ç‰©ä»¶ç”¨QRã‚³ãƒ¼ãƒ‰å¯¾å¿œãƒ»å˜ä¸€HTMLãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›</p>

        <div class="section">
            <h2 class="section-title">1. 360Â°ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
            <div class="upload-area" id="uploadArea">
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <p class="upload-text" id="uploadText">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’é¸æŠ</p>
                <p class="upload-hint">æ­£è·å††ç­’å›³æ³•ï¼ˆEquirectangularï¼‰ã®360Â°ç”»åƒ</p>
                <p class="size-info" id="sizeInfo"></p>
                <div id="imagePreview" class="image-preview" style="display: none;"></div>
            </div>
            <div class="recommendation">
                <strong>ğŸ“± æœ€é€Ÿèª­è¾¼ã®ãŸã‚ã®æ¨å¥¨è¨­å®šï¼š</strong>
                å¹…1024-2048pxã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º1MBä»¥ä¸‹ã®ç”»åƒã‚’ä½¿ç”¨ã™ã‚‹ã¨æœ€ã‚‚å¿«é©ã§ã™ã€‚THETA SC2ã®å ´åˆã¯ã€Œä½è§£åƒåº¦ãƒ¢ãƒ¼ãƒ‰ã€ã§ã®æ’®å½±ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
            </div>
            <div id="sizeWarning"></div>
        </div>

        <div class="section">
            <div class="field-header">
                <h2 class="section-title" style="margin: 0;">2. ç‰©ä»¶è©³ç´°æƒ…å ±</h2>
                <button class="btn btn-primary" id="addFieldBtn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    é …ç›®è¿½åŠ 
                </button>
            </div>
            <div class="field-list" id="fieldList"></div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-secondary" id="previewBtn" disabled>
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                </svg>
                ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
            </button>
            <button class="btn btn-primary" id="downloadBtn" disabled>
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                </svg>
                HTMLã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            </button>
        </div>

        <div class="info-box">
            <strong>ä½¿ç”¨æ–¹æ³•:</strong> ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’Webã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€ãã®URLã‚’QRã‚³ãƒ¼ãƒ‰åŒ–ã—ã¦ãã ã•ã„ã€‚
        </div>

        <div class="warning-box">
            <strong>ğŸ“Œ é‡è¦:</strong> ç”Ÿæˆã—ãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã¯å¿…ãšWebã‚µãƒ¼ãƒãƒ¼ï¼ˆãƒ¬ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãƒ¼ã€Google Driveã€Dropboxãªã©ï¼‰ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆPCå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã¨ã—ã¦é–‹ãã¨æ­£å¸¸ã«å‹•ä½œã—ã¾ã›ã‚“ã€‚
        </div>
    </div>

    <script>
        let imageData = null;
        let fields = [
            { id: '1', label: 'ãƒ“ãƒ«å', value: '' },
            { id: '2', label: 'éšæ•°', value: '' },
            { id: '3', label: 'æ‰€åœ¨', value: '' },
            { id: '4', label: 'åªé¢ç©', value: '' },
            { id: '5', label: 'è³ƒæ–™', value: '' },
            { id: '6', label: 'å‚™è€ƒ', value: '' }
        ];

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadText = document.getElementById('uploadText');
        const sizeInfo = document.getElementById('sizeInfo');
        const sizeWarning = document.getElementById('sizeWarning');
        const imagePreview = document.getElementById('imagePreview');
        const fieldList = document.getElementById('fieldList');
        const addFieldBtn = document.getElementById('addFieldBtn');
        const previewBtn = document.getElementById('previewBtn');
        const downloadBtn = document.getElementById('downloadBtn');

        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleImageUpload);
        addFieldBtn.addEventListener('click', addField);
        previewBtn.addEventListener('click', previewHTML);
        downloadBtn.addEventListener('click', downloadHTML);

        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            uploadText.textContent = 'å‡¦ç†ä¸­...';
            sizeInfo.textContent = '';

            const img = new Image();
            const reader = new FileReader();

            reader.onload = (event) => {
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    console.log('å…ƒç”»åƒã‚µã‚¤ã‚º:', width, 'x', height);
                    
                    // ã‚ˆã‚Šå°ã•ã„ã‚µã‚¤ã‚ºã«ï¼ˆæœ€é€Ÿèª­è¾¼ã®ãŸã‚ï¼‰
                    const maxWidth = 2048;
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // å“è³ª70%ã§åœ§ç¸®
                    imageData = canvas.toDataURL('image/jpeg', 0.7);
                    const sizeInMB = (imageData.length * 0.75 / 1024 / 1024).toFixed(2);
                    
                    console.log('åœ§ç¸®å¾Œ:', width, 'x', height, '/', sizeInMB, 'MB');
                    
                    uploadText.textContent = file.name;
                    
                    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
                    imagePreview.innerHTML = `<img src="${imageData}" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">`;
                    imagePreview.style.display = 'block';
                    
                    if (parseFloat(sizeInMB) <= 1.5) {
                        sizeInfo.textContent = `âœ“ åœ§ç¸®å¾Œ: ç´„${sizeInMB}MBï¼ˆæœ€é€Ÿï¼‰`;
                        sizeInfo.className = 'size-info';
                        sizeWarning.innerHTML = '';
                    } else if (parseFloat(sizeInMB) <= 3) {
                        sizeInfo.textContent = `âš  åœ§ç¸®å¾Œ: ç´„${sizeInMB}MBï¼ˆæ¨™æº–é€Ÿåº¦ï¼‰`;
                        sizeInfo.className = 'size-info';
                        sizeWarning.innerHTML = '';
                    } else {
                        sizeInfo.textContent = `âœ— åœ§ç¸®å¾Œ: ç´„${sizeInMB}MBï¼ˆèª­è¾¼é…ã„ï¼‰`;
                        sizeInfo.className = 'size-info warning';
                        sizeWarning.innerHTML = `
                            <div class="warning">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                                <span><strong>ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚</strong> ã‚ˆã‚Šå°ã•ã„å…ƒç”»åƒã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€ç”»åƒç·¨é›†ã‚½ãƒ•ãƒˆã§äº‹å‰ã«ãƒªã‚µã‚¤ã‚ºã—ã¦ãã ã•ã„ã€‚</span>
                            </div>
                        `;
                    }
                    
                    previewBtn.disabled = false;
                    downloadBtn.disabled = false;
                };
                
                img.onerror = () => {
                    alert('ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚åˆ¥ã®ç”»åƒã‚’è©¦ã—ã¦ãã ã•ã„ã€‚');
                    uploadText.textContent = 'ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’é¸æŠ';
                };
            };

            reader.readAsDataURL(file);
        }

        function renderFields() {
            fieldList.innerHTML = fields.map((field, index) => `
                <div class="field-item" draggable="true" data-id="${field.id}">
                    <div class="drag-handle">â˜°</div>
                    <div class="field-inputs">
                        <input type="text" class="input" placeholder="é …ç›®å" value="${field.label}" onchange="updateField('${field.id}', 'label', this.value)">
                        <input type="text" class="input" placeholder="å†…å®¹" value="${field.value}" onchange="updateField('${field.id}', 'value', this.value)">
                    </div>
                    <button class="btn-delete" onclick="deleteField('${field.id}')">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
            `).join('');

            setupDragAndDrop();
        }

        function setupDragAndDrop() {
            const items = document.querySelectorAll('.field-item');
            let draggedElement = null;

            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedElement = item;
                    item.style.opacity = '0.5';
                });

                item.addEventListener('dragend', (e) => {
                    item.style.opacity = '1';
                });

                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                item.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (draggedElement !== item) {
                        const draggedId = draggedElement.dataset.id;
                        const targetId = item.dataset.id;
                        
                        const draggedIndex = fields.findIndex(f => f.id === draggedId);
                        const targetIndex = fields.findIndex(f => f.id === targetId);
                        
                        const [removed] = fields.splice(draggedIndex, 1);
                        fields.splice(targetIndex, 0, removed);
                        
                        renderFields();
                    }
                });
            });
        }

        function updateField(id, key, value) {
            const field = fields.find(f => f.id === id);
            if (field) field[key] = value;
        }

        function deleteField(id) {
            fields = fields.filter(f => f.id !== id);
            renderFields();
        }

        function addField() {
            fields.push({
                id: Date.now().toString(),
                label: 'æ–°è¦é …ç›®',
                value: ''
            });
            renderFields();
        }

        function generateHTML() {
            if (!imageData) {
                alert('360Â°ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
                return null;
            }

            const fieldsData = fields.filter(f => f.value.trim() !== '');

            return `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360Â° ç‰©ä»¶ãƒ“ãƒ¥ãƒ¯ãƒ¼</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pannellum/2.5.6/pannellum.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pannellum/2.5.6/pannellum.js"><\/script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { width: 100%; height: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #000; }
        #panorama { width: 100%; height: 100%; }
        #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10000; color: white; }
        #start-screen h1 { font-size: 28px; margin-bottom: 20px; text-align: center; padding: 0 20px; }
        #start-screen p { font-size: 16px; margin-bottom: 30px; text-align: center; padding: 0 20px; opacity: 0.9; }
        #start-btn { padding: 15px 40px; font-size: 18px; background: white; color: #667eea; border: none; border-radius: 30px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.2s; }
        #start-btn:active { transform: scale(0.95); }
        #loading { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.95); padding: 30px 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 9999; text-align: center; min-width: 200px; }
        #loading.show { display: block; }
        #loading-progress { margin-top: 10px; color: #667eea; font-size: 14px; }
        .spinner { border: 4px solid #f3f4f6; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #detail-btn { position: fixed; bottom: 20px; right: 20px; padding: 12px 24px; background: rgba(255, 255, 255, 0.9); border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1000; color: #333; }
        #detail-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 2000; justify-content: center; align-items: center; padding: 20px; }
        #detail-modal.show { display: flex; }
        #detail-content { background: white; border-radius: 15px; max-width: 500px; width: 100%; max-height: 80vh; overflow-y: auto; padding: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        #detail-content h2 { margin-bottom: 20px; color: #333; font-size: 22px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .detail-item { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .detail-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .detail-label { font-weight: bold; color: #667eea; margin-bottom: 5px; font-size: 14px; }
        .detail-value { color: #333; font-size: 16px; line-height: 1.5; word-wrap: break-word; }
        #close-btn { margin-top: 20px; width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        #error-message { display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #fee; border: 2px solid #f00; color: #c00; padding: 15px 25px; border-radius: 10px; z-index: 10001; max-width: 90%; }
    </style>
</head>
<body>
    <div id="start-screen">
        <h1>360Â° ç‰©ä»¶ãƒ“ãƒ¥ãƒ¯ãƒ¼</h1>
        <p>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’å‹•ã‹ã—ã¦å‘¨å›²ã‚’è¦‹æ¸¡ã›ã¾ã™</p>
        <button id="start-btn">ä½“é¨“ã‚’é–‹å§‹</button>
    </div>
    <div id="loading">
        <div class="spinner"></div>
        <p style="color: #333; font-weight: 600;">ç”»åƒã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
        <div id="loading-progress">æº–å‚™ä¸­</div>
    </div>
    <div id="error-message"></div>
    <div id="panorama"></div>
    <button id="detail-btn" style="display:none;">ç‰©ä»¶è©³ç´°</button>
    <div id="detail-modal">
        <div id="detail-content">
            <h2>ç‰©ä»¶è©³ç´°æƒ…å ±</h2>
            ${fieldsData.map(field => `
            <div class="detail-item">
                <div class="detail-label">${field.label}</div>
                <div class="detail-value">${field.value.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
            </div>
            `).join('')}
            <button id="close-btn">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <script>
        console.log('=== 360Â° ãƒ“ãƒ¥ãƒ¯ãƒ¼ èµ·å‹• ===');
        let viewer;
        const startScreen = document.getElementById('start-screen');
        const loadingScreen = document.getElementById('loading');
        const loadingProgress = document.getElementById('loading-progress');
        const errorMessage = document.getElementById('error-message');
        const startBtn = document.getElementById('start-btn');
        const detailBtn = document.getElementById('detail-btn');
        const detailModal = document.getElementById('detail-modal');
        const closeBtn = document.getElementById('close-btn');

        function showError(msg) {
            console.error('ã‚¨ãƒ©ãƒ¼:', msg);
            errorMessage.textContent = msg;
            errorMessage.style.display = 'block';
            loadingScreen.classList.remove('show');
        }

        startBtn.addEventListener('click', async () => {
            console.log('é–‹å§‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯');
            loadingProgress.textContent = 'ã‚¸ãƒ£ã‚¤ãƒ­ã‚»ãƒ³ã‚µãƒ¼ç¢ºèªä¸­...';
            
            let enableGyro = false;
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permission = await DeviceOrientationEvent.requestPermission();
                    enableGyro = permission === 'granted';
                    console.log('ã‚¸ãƒ£ã‚¤ãƒ­è¨±å¯:', enableGyro);
                } catch (error) { 
                    console.log('ã‚¸ãƒ£ã‚¤ãƒ­ã‚¨ãƒ©ãƒ¼:', error);
                }
            } else if (window.DeviceOrientationEvent) {
                enableGyro = true;
                console.log('ã‚¸ãƒ£ã‚¤ãƒ­åˆ©ç”¨å¯èƒ½');
            }
            
            startScreen.style.display = 'none';
            loadingScreen.classList.add('show');
            loadingProgress.textContent = 'ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ä¸­...';
            
            setTimeout(() => {
                initViewer(enableGyro);
            }, 100);
        });

        function initViewer(enableGyro) {
            console.log('ãƒ“ãƒ¥ãƒ¯ãƒ¼åˆæœŸåŒ–é–‹å§‹');
            loadingProgress.textContent = 'ãƒ“ãƒ¥ãƒ¯ãƒ¼æ§‹ç¯‰ä¸­...';
            
            try {
                if (typeof pannellum === 'undefined') {
                    showError('Pannellumãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                console.log('Pannellumèª­è¾¼OK');
                loadingProgress.textContent = '360Â°ç”»åƒã‚’å±•é–‹ä¸­...';
                
                viewer = pannellum.viewer('panorama', {
                    type: 'equirectangular',
                    panorama: '${imageData}',
                    autoLoad: true,
                    orientationOnByDefault: enableGyro,
                    showControls: false,
                    mouseZoom: false,
                    doubleClickZoom: false,
                    friction: 0.15
                });
                
                console.log('ãƒ“ãƒ¥ãƒ¯ãƒ¼ä½œæˆå®Œäº†');
                
                viewer.on('load', () => {
                    console.log('ç”»åƒèª­è¾¼å®Œäº†ï¼');
                    loadingScreen.classList.remove('show');
                    detailBtn.style.display = 'block';
                });
                
                viewer.on('error', (err) => {
                    console.error('ãƒ“ãƒ¥ãƒ¯ãƒ¼ã‚¨ãƒ©ãƒ¼:', err);
                    showError('360Â°ç”»åƒã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
                });
                
                setTimeout(() => {
                    if (loadingScreen.classList.contains('show')) {
                        console.warn('èª­è¾¼ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ15ç§’ï¼‰');
                        loadingProgress.textContent = 'ã¾ã‚‚ãªãå®Œäº†ã—ã¾ã™...';
                    }
                }, 15000);
                
            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                showError('ãƒ“ãƒ¥ãƒ¯ãƒ¼ã®åˆæœŸåŒ–ã«å¤±æ•—: ' + error.message);
            }
        }

        detailBtn.addEventListener('click', () => detailModal.classList.add('show'));
        closeBtn.addEventListener('click', () => detailModal.classList.remove('show'));
        detailModal.addEventListener('click', (e) => { if (e.target === detailModal) detailModal.classList.remove('show'); });
        
        console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²å®Œäº†');
    <\/script>
</body>
</html>`;
        }

        function previewHTML() {
            const html = generateHTML();
            if (!html) return;

            const newWindow = window.open('', '_blank');
            if (newWindow) {
                newWindow.document.write(html);
                newWindow.document.close();
            } else {
                alert('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚');
            }
        }

        function downloadHTML() {
            const html = generateHTML();
            if (!html) return;

            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '360-viewer.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚\\n\\nã€é‡è¦ã€‘æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:\\n1. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’Webã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰\\n2. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®URLã‚’QRã‚³ãƒ¼ãƒ‰åŒ–\\n\\nâ€»ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆPCå†…ï¼‰ã§é–‹ã„ã¦ã‚‚æ­£å¸¸ã«å‹•ä½œã—ã¾ã›ã‚“ã€‚å¿…ãšWebã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
        }

        renderFields();
        console.log('ãƒ„ãƒ¼ãƒ«åˆæœŸåŒ–å®Œäº†');
    </script>
</body>
</html>